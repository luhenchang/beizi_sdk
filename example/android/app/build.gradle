plugins {
    id "com.android.application"
    id "kotlin-android"
    // The Flutter Gradle Plugin must be applied after the Android and Kotlin Gradle plugins.
    id "dev.flutter.flutter-gradle-plugin"
}

def localProperties = new Properties()
def localPropertiesFile = rootProject.file("local.properties")
if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader("UTF-8") { reader ->
        localProperties.load(reader)
    }
}

def flutterVersionCode = localProperties.getProperty("flutter.versionCode")
if (flutterVersionCode == null) {
    flutterVersionCode = "1"
}

def flutterVersionName = localProperties.getProperty("flutter.versionName")
if (flutterVersionName == null) {
    flutterVersionName = "1.0"
}

android {
    signingConfigs {
        release {
            storeFile file('C:\\Users\\12769\\Desktop\\key')
            storePassword '123456'
            keyAlias 'key'
            keyPassword '123456'
        }
    }
    namespace = "com.beizi.beizi_sdk_example"
    compileSdk = flutter.compileSdkVersion
    ndkVersion = flutter.ndkVersion

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }

    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_11.toString()
    }

    defaultConfig {
        // TODO: Specify your own unique Application ID (https://developer.android.com/studio/build/application-id.html).
        applicationId = "com.beizi.beizi_sdk_example"
        // You can update the following values to match your application needs.
        // For more information, see: https://docs.flutter.dev/deployment/android#reviewing-the-gradle-build-configuration.
        minSdk = flutter.minSdkVersion
        targetSdk = flutter.targetSdkVersion
        versionCode = flutterVersionCode.toInteger()
        versionName = flutterVersionName
        ndk {
            // 这是导致冲突的冗余或冲突配置
            abiFilters 'armeabi-v7a', 'x86_64', 'arm64-v8a'
        }
    }
//    splits {
//        abi {
//            enable true
//            // 排除 x86 和 x86_64 架构以进一步减小体积
//            // 现在的手机几乎都是 ARM 架构，x86 架构的 Android 设备很少见
//            // 如果需要支持模拟器或 x86 设备，可以保留它们
//            reset()
//            include "armeabi-v7a", "x86_64", "arm64-v8a"
//            // 或 include "x86", "x86_64", "armeabi-v7a", "arm64-v8a"
//            universalApk false // 设置为 false，不生成包含所有架构的“通用”APK
//        }
//    }
    buildTypes {
        release {
            // 启用代码压缩（code shrinking）和混淆（minification）
            minifyEnabled true

            // 启用资源收缩（resource shrinking），仅在 minifyEnabled 为 true 时有效
            shrinkResources true

            // 指定混淆规则文件
            // proguard-android-optimize.txt 是 Android SDK 提供的通用规则
            // proguard-rules.pro 是您自己的项目特定规则文件
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    repositories {
        // 添加本地仓库，指向存放 AAR 的目录
        flatDir {
            dirs 'libs'  // 表示 AAR 文件在 app/libs 目录下
        }
    }
    dependencies {
        implementation(name: 'beizi_fusion_sdk_5.2.2.2', ext: 'aar')
        implementation("androidx.appcompat:appcompat:1.7.1")
    }
}

flutter {
    source = "../.."
}
